#!/bin/sh

# --- Rubocop lint ---

echo "\nRunning rubocop ðŸš“ ðŸ’¨ ðŸ’¨ ðŸ’¨\n"

declare -a RUBOCOP_ERRORS=()

for file in $(git diff --cached --name-only | grep -E '\.rb$')
do
	RUBOCOP_ERRORS+=("$(docker-compose exec -T web rubocop $file | grep -e 'C:' -e 'E:')")
done

if [[ "$RUBOCOP_ERRORS" != "" ]]; then
	echo "\n ðŸš¨ BEE-BOP! There are some things that you need to fix before commiting!\n"
	history -p "${RUBOCOP_ERRORS[@]}"
  exit 1
fi

echo "\n âœ… Done! Rubocop has no complains!\n"

# --- ERB lint ---
echo "\nRunning ERB lint ðŸš“ ðŸ’¨ ðŸ’¨ ðŸ’¨\n"

declare -a ERB_LINT_ERRORS=()

for file in $(git diff --cached --name-only | grep -E '\.erb$')
do
	ERB_LINT_ERRORS+=("$(docker-compose exec -T web bundle exec erblint --format compact $file | grep -e '\.erb:')")
done

if [[ "$ERB_LINT_ERRORS" != "" ]]; then
	echo "\n ðŸš¨ BEE-BOP! There are some things that you need to fix before commiting!\n"
	history -p "${ERB_LINT_ERRORS[@]}"
  exit 1
fi

echo "\n âœ… Done! ERB lint has no complains!\n"

exit 0
